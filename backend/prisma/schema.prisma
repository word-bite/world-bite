generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Restaurante {
  id                  Int       @id @default(autoincrement())
  nome                String    @db.VarChar(100)
  cnpj                String    @unique @db.VarChar(14)
  descricao           String?
  endereco            String
  telefone_contato    String?   @db.VarChar(20)
  email_contato       String?   @db.VarChar(255)
  nota_media          Decimal?  @default(0.00) @db.Decimal(3, 2)
  tempo_medio_entrega Int?
  pais_id             String    @db.VarChar(255)
  ativo               Boolean?  @default(true)
  horario_abertura    DateTime? @db.Time(6)
  horario_fechamento  DateTime? @db.Time(6)
  data_criacao        DateTime  @default(now()) @db.Timestamptz(6)
  data_atualizacao    DateTime  @default(now()) @db.Timestamptz(6)
  pedidos             Pedido[]
  pratos              Prato[]

  @@map("Restaurantes")
}

model Prato {
  id              Int            @id @default(autoincrement())
  nome            String         @db.VarChar(100)
  descricao       String
  preco           Decimal        @db.Decimal(10, 2)
  categoria       CategoriaPrato
  disponivel      Boolean        @default(true)
  urlImagem       String?        @map("url_imagem") @db.VarChar(255)
  dataCriacao     DateTime       @default(now()) @map("data_criacao") @db.Timestamptz(6)
  dataAtualizacao DateTime       @updatedAt @map("data_atualizacao") @db.Timestamptz(6)
  restauranteId   Int            @map("restaurante_id")
  restaurante     Restaurante    @relation(fields: [restauranteId], references: [id])

  @@map("pratos")
}

model Usuario {
  id                  Int        @id @default(autoincrement())
  nome                String     @db.VarChar(100)
  email               String?    @unique @db.VarChar(255)
  telefone            String?    @unique @db.VarChar(20)
  facebook_id         String?    @unique @db.VarChar(255)
  avatar_url          String?    @db.VarChar(500)
  provider            String?    @default("local") @db.VarChar(50)
  codigo_verificacao  String?    @db.VarChar(10)
  codigo_expira_em    DateTime?  @db.Timestamptz(6)
  email_verificado    Boolean    @default(false)
  telefone_verificado Boolean    @default(false)
  ativo               Boolean    @default(true)
  data_criacao        DateTime   @default(now()) @db.Timestamptz(6)
  data_atualizacao    DateTime   @updatedAt @db.Timestamptz(6)
  ultimo_login        DateTime?  @db.Timestamptz(6)
  enderecos           Endereco[]
  pedidos             Pedido[]

  @@map("usuarios")
}

model Pedido {
  id             Int         @id @default(autoincrement())
  clienteId      Int         @map("cliente_id")
  restauranteId  Int         @map("restaurante_id")
  tipoEntrega    String      @map("tipo_entrega")
  codigoRetirada String?     @map("codigo_retirada")
  status         String      @default("pendente")
  itens          Json
  valorTotal     Decimal     @map("valor_total") @db.Decimal(10, 2)
  observacoes    String?
  criadoEm       DateTime    @default(now()) @map("criado_em") @db.Timestamptz(6)
  atualizadoEm   DateTime    @updatedAt @map("atualizado_em") @db.Timestamptz(6)
  cliente        Usuario     @relation(fields: [clienteId], references: [id])
  restaurante    Restaurante @relation(fields: [restauranteId], references: [id])

  @@map("pedidos")
}

model Endereco {
  id          Int      @id @default(autoincrement())
  logradouro  String   @db.VarChar(255)
  numero      String   @db.VarChar(20)
  complemento String?  @db.VarChar(100)
  bairro      String   @db.VarChar(100)
  cidade      String   @db.VarChar(100)
  estado      String   @db.VarChar(2)
  cep         String   @db.VarChar(9)
  apelido     String?  @db.VarChar(50)
  dataCriacao DateTime @default(now()) @map("data_criacao")
  usuarioId   Int      @map("usuario_id")
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("enderecos")
}

enum CategoriaPrato {
  PRINCIPAL
  SOBREMESA
  ENTRADA
  BEBIDA
  PROMOCAO
}
